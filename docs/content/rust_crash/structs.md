# Rust 速成课/结构体, 函数与方法

各位 Rust 的朋友们大家好, 我是 Yeah 老师. 我们要谈论一下结构体, 对于构建程序应用来说, 使用结构体能让你的程序显得更加结构化, emm, 这句话说了和没说一样, 但事实上就是这样. 结构体它指的是一种复合数据结构, 可让打包一组多个相关的值到一起. 如果你熟悉面向对象的语言, 则结构就像对象的数据属性一样.

不过要注意哦, Rust 并不是面向对象的语言. 其实我本人不是很欣赏面向对象的哲学啦, 基本上我很少会去主动使用面向对象的语言. Erlang 语言的作者 Joe Armstrong 也非常不喜欢面向对象编程, 他曾经说了一段很有名的话: "面向对象编程的问题是, 默认带有环境. 你只想要一个香蕉, 但是得到了一只拿着香蕉的大猩猩, 甚至还有整个丛林". 记得这句话, 它很有用, 因为经常可以引用这句话终结一些和新手之间无意义的争论.

扯得有点远, 让我们把话题拉回来. 结构体和对象的区别, 在我看来是, 结构体是数据的集合, 而对象是含有数据, 它们的主语是不同的. 结构体的定义中数据占据主要地位, 而对象的定义中数据占据次要地位.

要定义一个结构, 我们需要输入关键字 struct 并命名整个结构. 然后, 敲入一对大括号内, 定义数据的名称和类型, 我们将其称为字段, 就像下面这样, 我定义了一个 User 结构体. 用户有它的名字, 作为字符串类型, 年龄, 无符号 32 位整型, 还有他拥有自己的电子邮箱.

```rs
struct User {
    username: String,
    age: u32,
    email: String,
}
```

我们完成了对结构体的定义, 为了使用该结构体, 我们可以通过为每个字段指定具体值来创建该结构的实例.

```rs
let someone = User {
    username: String::from("someone"),
    age: 18,
    email: String::from("someone@example.com"),
};
```

使用点符号可以从结构体中取得一个字段的值

```rs
println!("{}", someone.username);
```

我想提出一个问题, 如果我现在想修改 someone 的年龄, 我应该怎么做? 回忆一下, Rust 中的变量默认是不可变的, 要让一个变量可变必须加上 mut 修饰词是吗? 所以我们将 `let someone` 修改成 `let mut someone`, 然后就可以直接修改字段了.

## 函数

我们想让这个用户向你打个招呼, 他会首先向你打印 Hello, 然后再告诉你他的名字. 为此我们可以创建一个函数, 这个函数接收 User 类型的变量作为参数.

```rs
fn sayhello(user: &User) {
    println!("Hello, I'm {}", user.username);
}
```

然后就可以这么去使用它

```rs
sayhello(&someone);
```

## 方法

方法与函数相似: 它们使用 fn 关键字及其名称进行声明, 可以具有参数和返回值, 并且包含一些在其他地方调用时运行的代码. 但是, 方法与函数的不同之处在于它们是在结构体的上下文中定义的, 并且它们的第一个参数始终是 self, 它表示调用该方法的结构体实例.

我们接着上面的例子, 首先使用 impl 申明我们准备为 User 结构体定义方法, 然后将上面的 sayhello 函数复制过来, 将参数名改成 self, 即可.

```rs
impl User {
    fn sayhello(&self) {
        println!("Hello, I'm {}", self.username);
    }
}
```
